{"ast":null,"code":"import { createSlice } from '@reduxjs/toolkit';\nimport { findTopicById, isDescendant, updateTopicTreeStatus } from '../utils/topicUtils';\n// 创建初始状态\nconst initialState = {\n  currentMap: {\n    id: '1',\n    rootTopic: {\n      id: '1',\n      title: '项目计划',\n      isCompleted: false,\n      children: []\n    },\n    createdAt: new Date(),\n    updatedAt: new Date(),\n    settings: {\n      completedColor: '#4CAF50',\n      incompletedColor: '#FF5252',\n      showNotifications: true,\n      autoLayout: true\n    }\n  },\n  selectedTopic: null\n};\nconst mindMapSlice = createSlice({\n  name: 'mindMap',\n  initialState,\n  reducers: {\n    toggleTopicComplete(state, action) {\n      if (!state.currentMap) return;\n      const topic = findTopicById(state.currentMap.rootTopic, action.payload);\n      if (topic) {\n        topic.isCompleted = !topic.isCompleted;\n        // 更新整个树的状态\n        updateTopicTreeStatus(state.currentMap.rootTopic);\n      }\n    },\n    updateTopicColor(state, action) {\n      var _state$currentMap;\n      const topic = findTopicById((_state$currentMap = state.currentMap) === null || _state$currentMap === void 0 ? void 0 : _state$currentMap.rootTopic, action.payload.id);\n      if (topic) {\n        topic.color = action.payload.color;\n      }\n    },\n    addTopic(state, action) {\n      if (!state.currentMap) return;\n      const newTopic = {\n        id: Date.now().toString(),\n        title: action.payload.title,\n        isCompleted: false,\n        children: []\n      };\n      if (action.payload.parentId) {\n        const parentTopic = findTopicById(state.currentMap.rootTopic, action.payload.parentId);\n        if (parentTopic) {\n          parentTopic.children.push(newTopic);\n        }\n      } else {\n        state.currentMap.rootTopic.children.push(newTopic);\n      }\n    },\n    connectTopics(state, action) {\n      if (!state.currentMap) return;\n      const sourceTopic = findTopicById(state.currentMap.rootTopic, action.payload.sourceId);\n      const targetTopic = findTopicById(state.currentMap.rootTopic, action.payload.targetId);\n      if (sourceTopic && targetTopic) {\n        // 防止循环引用\n        if (isDescendant(targetTopic, sourceTopic)) return;\n\n        // 从原位置移除\n        removeTopicFromParent(state.currentMap.rootTopic, sourceTopic.id);\n\n        // 添加到新位置\n        targetTopic.children.push(sourceTopic);\n      }\n    }\n  }\n});\n\n// 辅助函数：从父节点中移除主题\nconst removeTopicFromParent = (root, topicId) => {\n  const index = root.children.findIndex(child => child.id === topicId);\n  if (index !== -1) {\n    root.children.splice(index, 1);\n    return true;\n  }\n  for (const child of root.children) {\n    if (removeTopicFromParent(child, topicId)) {\n      return true;\n    }\n  }\n  return false;\n};\nexport const {\n  toggleTopicComplete,\n  updateTopicColor,\n  addTopic,\n  connectTopics\n} = mindMapSlice.actions;\nexport default mindMapSlice;","map":{"version":3,"names":["createSlice","findTopicById","isDescendant","updateTopicTreeStatus","initialState","currentMap","id","rootTopic","title","isCompleted","children","createdAt","Date","updatedAt","settings","completedColor","incompletedColor","showNotifications","autoLayout","selectedTopic","mindMapSlice","name","reducers","toggleTopicComplete","state","action","topic","payload","updateTopicColor","_state$currentMap","color","addTopic","newTopic","now","toString","parentId","parentTopic","push","connectTopics","sourceTopic","sourceId","targetTopic","targetId","removeTopicFromParent","root","topicId","index","findIndex","child","splice","actions"],"sources":["D:/Work/SIWEI/src/store/mindMapSlice.ts"],"sourcesContent":["import { createSlice, PayloadAction } from '@reduxjs/toolkit';\r\nimport { MindMap, Topic } from '../types/MindMap';\r\nimport { findTopicById, isDescendant, updateTopicTreeStatus } from '../utils/topicUtils';\r\n\r\ninterface MindMapState {\r\n  currentMap: MindMap | null;\r\n  selectedTopic: string | null;\r\n}\r\n\r\n// 创建初始状态\r\nconst initialState: MindMapState = {\r\n  currentMap: {\r\n    id: '1',\r\n    rootTopic: {\r\n      id: '1',\r\n      title: '项目计划',\r\n      isCompleted: false,\r\n      children: []\r\n    },\r\n    createdAt: new Date(),\r\n    updatedAt: new Date(),\r\n    settings: {\r\n      completedColor: '#4CAF50',\r\n      incompletedColor: '#FF5252',\r\n      showNotifications: true,\r\n      autoLayout: true\r\n    }\r\n  },\r\n  selectedTopic: null,\r\n};\r\n\r\nconst mindMapSlice = createSlice({\r\n  name: 'mindMap',\r\n  initialState,\r\n  reducers: {\r\n    toggleTopicComplete(state, action: PayloadAction<string>) {\r\n      if (!state.currentMap) return;\r\n      const topic = findTopicById(state.currentMap.rootTopic, action.payload);\r\n      if (topic) {\r\n        topic.isCompleted = !topic.isCompleted;\r\n        // 更新整个树的状态\r\n        updateTopicTreeStatus(state.currentMap.rootTopic);\r\n      }\r\n    },\r\n\r\n    updateTopicColor(state, action: PayloadAction<{id: string; color: string}>) {\r\n      const topic = findTopicById(state.currentMap?.rootTopic, action.payload.id);\r\n      if (topic) {\r\n        topic.color = action.payload.color;\r\n      }\r\n    },\r\n\r\n    addTopic(state, action: PayloadAction<{title: string; parentId: string | null}>) {\r\n      if (!state.currentMap) return;\r\n\r\n      const newTopic: Topic = {\r\n        id: Date.now().toString(),\r\n        title: action.payload.title,\r\n        isCompleted: false,\r\n        children: []\r\n      };\r\n\r\n      if (action.payload.parentId) {\r\n        const parentTopic = findTopicById(state.currentMap.rootTopic, action.payload.parentId);\r\n        if (parentTopic) {\r\n          parentTopic.children.push(newTopic);\r\n        }\r\n      } else {\r\n        state.currentMap.rootTopic.children.push(newTopic);\r\n      }\r\n    },\r\n\r\n    connectTopics(state, action: PayloadAction<{sourceId: string; targetId: string}>) {\r\n      if (!state.currentMap) return;\r\n\r\n      const sourceTopic = findTopicById(state.currentMap.rootTopic, action.payload.sourceId);\r\n      const targetTopic = findTopicById(state.currentMap.rootTopic, action.payload.targetId);\r\n\r\n      if (sourceTopic && targetTopic) {\r\n        // 防止循环引用\r\n        if (isDescendant(targetTopic, sourceTopic)) return;\r\n\r\n        // 从原位置移除\r\n        removeTopicFromParent(state.currentMap.rootTopic, sourceTopic.id);\r\n\r\n        // 添加到新位置\r\n        targetTopic.children.push(sourceTopic);\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\n// 辅助函数：从父节点中移除主题\r\nconst removeTopicFromParent = (root: Topic, topicId: string): boolean => {\r\n  const index = root.children.findIndex(child => child.id === topicId);\r\n  if (index !== -1) {\r\n    root.children.splice(index, 1);\r\n    return true;\r\n  }\r\n\r\n  for (const child of root.children) {\r\n    if (removeTopicFromParent(child, topicId)) {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport const {\r\n  toggleTopicComplete,\r\n  updateTopicColor,\r\n  addTopic,\r\n  connectTopics\r\n} = mindMapSlice.actions;\r\nexport default mindMapSlice;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}