{"ast":null,"code":"import { mindMapAPI } from '../services/api';\nconst MINDMAPS_KEY = 'mindmaps';\nconst SHARED_MAPS_KEY = 'shared-mindmaps';\n\n// 保存思维导图\nexport const saveMindMap = async mindMap => {\n  try {\n    if (mindMap.id) {\n      await mindMapAPI.updateMap(mindMap.id, mindMap);\n    } else {\n      await mindMapAPI.createMap(mindMap);\n    }\n    return true;\n  } catch (error) {\n    console.error('保存失败:', error);\n    return false;\n  }\n};\n\n// 获取所有思维导图\nexport const getAllMindMaps = async () => {\n  try {\n    const response = await mindMapAPI.getAllMaps();\n    return response.data;\n  } catch (error) {\n    console.error('获取思维导图失败:', error);\n    return [];\n  }\n};\n\n// 发布/分享思维导图\nexport const publishMindMap = async (mindMap, authorId, authorName, isPublic = true) => {\n  try {\n    const sharedMaps = getAllSharedMindMaps();\n    const cloudMap = {\n      ...mindMap,\n      authorId,\n      authorName,\n      publishedAt: new Date().toISOString(),\n      likes: 0,\n      comments: [],\n      isPublic\n    };\n    const index = sharedMaps.findIndex(m => m.id === mindMap.id);\n    if (index >= 0) {\n      sharedMaps[index] = cloudMap;\n    } else {\n      sharedMaps.push(cloudMap);\n    }\n    localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(sharedMaps));\n    return true;\n  } catch (error) {\n    console.error('发布失败:', error);\n    return false;\n  }\n};\n\n// 获取所有分享的思维导图\nexport const getAllSharedMindMaps = () => {\n  try {\n    return JSON.parse(localStorage.getItem(SHARED_MAPS_KEY) || '[]');\n  } catch (error) {\n    console.error('获取分享思维导图失败:', error);\n    return [];\n  }\n};\n\n// 获取用户的思维导图\nexport const getUserMindMaps = userId => {\n  const allMaps = getAllSharedMindMaps();\n  return allMaps.filter(map => map.authorId === userId);\n};\n\n// 点赞\nexport const likeMindMap = async mapId => {\n  try {\n    const maps = getAllSharedMindMaps();\n    const index = maps.findIndex(map => map.id === mapId);\n    if (index >= 0) {\n      maps[index].likes = (maps[index].likes || 0) + 1;\n      localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(maps));\n      return true;\n    }\n    return false;\n  } catch (error) {\n    console.error('点赞失败:', error);\n    return false;\n  }\n};\n\n// 添加评论\nexport const addComment = async (mapId, authorId, authorName, content) => {\n  try {\n    const maps = getAllSharedMindMaps();\n    const index = maps.findIndex(map => map.id === mapId);\n    if (index >= 0) {\n      const comment = {\n        id: Date.now().toString(),\n        authorId,\n        authorName,\n        content,\n        createdAt: new Date().toISOString()\n      };\n      if (!maps[index].comments) {\n        maps[index].comments = [];\n      }\n      maps[index].comments.push(comment);\n      localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(maps));\n      return true;\n    }\n    return false;\n  } catch (error) {\n    console.error('添加评论失败:', error);\n    return false;\n  }\n};","map":{"version":3,"names":["mindMapAPI","MINDMAPS_KEY","SHARED_MAPS_KEY","saveMindMap","mindMap","id","updateMap","createMap","error","console","getAllMindMaps","response","getAllMaps","data","publishMindMap","authorId","authorName","isPublic","sharedMaps","getAllSharedMindMaps","cloudMap","publishedAt","Date","toISOString","likes","comments","index","findIndex","m","push","localStorage","setItem","JSON","stringify","parse","getItem","getUserMindMaps","userId","allMaps","filter","map","likeMindMap","mapId","maps","addComment","content","comment","now","toString","createdAt"],"sources":["D:/Work/SIWEI/src/utils/cloudStorage.ts"],"sourcesContent":["import { mindMapAPI } from '../services/api';\r\nimport { MindMap } from '../types/MindMap';\r\n\r\ninterface CloudMindMap extends MindMap {\r\n  authorId?: string;\r\n  authorName?: string;\r\n  publishedAt?: string;\r\n  likes?: number;\r\n  comments?: Comment[];\r\n  isPublic?: boolean;\r\n}\r\n\r\ninterface Comment {\r\n  id: string;\r\n  authorId: string;\r\n  authorName: string;\r\n  content: string;\r\n  createdAt: string;\r\n}\r\n\r\nconst MINDMAPS_KEY = 'mindmaps';\r\nconst SHARED_MAPS_KEY = 'shared-mindmaps';\r\n\r\n// 保存思维导图\r\nexport const saveMindMap = async (mindMap: MindMap): Promise<boolean> => {\r\n  try {\r\n    if (mindMap.id) {\r\n      await mindMapAPI.updateMap(mindMap.id, mindMap);\r\n    } else {\r\n      await mindMapAPI.createMap(mindMap);\r\n    }\r\n    return true;\r\n  } catch (error) {\r\n    console.error('保存失败:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// 获取所有思维导图\r\nexport const getAllMindMaps = async (): Promise<MindMap[]> => {\r\n  try {\r\n    const response = await mindMapAPI.getAllMaps();\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('获取思维导图失败:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// 发布/分享思维导图\r\nexport const publishMindMap = async (\r\n  mindMap: MindMap,\r\n  authorId: string,\r\n  authorName: string,\r\n  isPublic: boolean = true\r\n): Promise<boolean> => {\r\n  try {\r\n    const sharedMaps = getAllSharedMindMaps();\r\n    const cloudMap: CloudMindMap = {\r\n      ...mindMap,\r\n      authorId,\r\n      authorName,\r\n      publishedAt: new Date().toISOString(),\r\n      likes: 0,\r\n      comments: [],\r\n      isPublic\r\n    };\r\n\r\n    const index = sharedMaps.findIndex(m => m.id === mindMap.id);\r\n    if (index >= 0) {\r\n      sharedMaps[index] = cloudMap;\r\n    } else {\r\n      sharedMaps.push(cloudMap);\r\n    }\r\n\r\n    localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(sharedMaps));\r\n    return true;\r\n  } catch (error) {\r\n    console.error('发布失败:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// 获取所有分享的思维导图\r\nexport const getAllSharedMindMaps = (): CloudMindMap[] => {\r\n  try {\r\n    return JSON.parse(localStorage.getItem(SHARED_MAPS_KEY) || '[]');\r\n  } catch (error) {\r\n    console.error('获取分享思维导图失败:', error);\r\n    return [];\r\n  }\r\n};\r\n\r\n// 获取用户的思维导图\r\nexport const getUserMindMaps = (userId: string): CloudMindMap[] => {\r\n  const allMaps = getAllSharedMindMaps();\r\n  return allMaps.filter(map => map.authorId === userId);\r\n};\r\n\r\n// 点赞\r\nexport const likeMindMap = async (mapId: string): Promise<boolean> => {\r\n  try {\r\n    const maps = getAllSharedMindMaps();\r\n    const index = maps.findIndex(map => map.id === mapId);\r\n    if (index >= 0) {\r\n      maps[index].likes = (maps[index].likes || 0) + 1;\r\n      localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(maps));\r\n      return true;\r\n    }\r\n    return false;\r\n  } catch (error) {\r\n    console.error('点赞失败:', error);\r\n    return false;\r\n  }\r\n};\r\n\r\n// 添加评论\r\nexport const addComment = async (\r\n  mapId: string,\r\n  authorId: string,\r\n  authorName: string,\r\n  content: string\r\n): Promise<boolean> => {\r\n  try {\r\n    const maps = getAllSharedMindMaps();\r\n    const index = maps.findIndex(map => map.id === mapId);\r\n    if (index >= 0) {\r\n      const comment: Comment = {\r\n        id: Date.now().toString(),\r\n        authorId,\r\n        authorName,\r\n        content,\r\n        createdAt: new Date().toISOString()\r\n      };\r\n\r\n      if (!maps[index].comments) {\r\n        maps[index].comments = [];\r\n      }\r\n      maps[index].comments.push(comment);\r\n      localStorage.setItem(SHARED_MAPS_KEY, JSON.stringify(maps));\r\n      return true;\r\n    }\r\n    return false;\r\n  } catch (error) {\r\n    console.error('添加评论失败:', error);\r\n    return false;\r\n  }\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}